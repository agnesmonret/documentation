# Retype APP GitHub Actions - Build

GitHub action to Build Retype documentation for the repository. The built documentation is then made available for subsequent steps to publish or upload to the hosting/destination of choice.

## Introduction

This action runs Retype over the repository to build documentation in the form of a static web site that can be published to any hosting solution available.

After the action completes, it will export the `retype-output-root` value for the next steps to handle the built files. These files can be pushed back to GitHub (for GitHub Pages hosted websites), ftp-pushed to hosting or any other form of website publication target.

This action will look for **retype.json** file at repository root. If it is found, then it is used, overriding a number of settings depending on the input received. This includes the `output` value, which points to a temporary folder in the runner environment, and also other settings adjusted by the available inputs the action can receive.

If the **retype.json** file is not found, then retype will run with the default configuration generated by the `retype init` command.

See more about Retype at [Retype WebSite](https://retype.com/).

## Prerequisites

You can run Retype without a license key if you don't exceed the documentation count limits on a non-profit project. See about licensing at [Retype WebSite](https://retype.com/).

If you are exceeding the limits or using Retype commercially, you need to provide a valid license key. Please use a secure mean to store the key, like GitHub repository or organizations' secrets. For more information on encrypted secrets, see [Encrypted Secrets article at Google Docs](https://docs.github.com/en/actions/reference/encrypted-secrets).

Optionally, and strongly recommended, include the [actions/setup-dotnet](https://github.com/actions/setup-dotnet) step before Retype one. This will the required .NET version is installed to use the slim dotnet tool instead of self-contained NPM packages, which is several tens of megabytes larger to download. All examples provided in this documentation will include the correct reference to this step.

Documentation in .md markdown format for general documentation/blogging and C# code/project if doing API documentation. See more about formats and enabling API documentation at [Retype WebSite](https://retype.com/).

## Usage

```yaml
steps:
- uses: actions/checkout@v2

- uses: actions/setup-dotnet@v1
  with:
    dotnet-version: 5.0.x

- uses: retypeapp/action-build
```

## Inputs

### `base`

Overrides the base directory to set up Retype. This is required if the target hosting will prefix a path to your website; like the repository name in GitHub Pages. Examples: http://www.mydomain.com/docs/index.html (`base: docs`), https://www.mydomain.com/en/index.html (`base: en`). Optional, as the value can be committed to the **retype.json** file within the repository.

Defaults to empty / unset.

### `license`

Specifies the license key to be used with retype. Never save the license key within the committed **retype.json** file in the repository. Use a GitHub secret to provide it instead. For information on how to set up secrets, see [Encrypted Secrets at Google Docs](https://docs.github.com/en/actions/reference/encrypted-secrets).

If Retype is used in a non-commercial environment and is documentation articles are behind the unlicensed threshold this input is optional.

### `project-name`

Specifies a given project name to be set instead of whatever is in **retype.json** or the default value by `retype init` (in case **retype.json** is not available in the repository root).

## Examples

Here are some simple and common use case scenarios; for most examples below the following workflow file will be considered:

```yaml
name: document
on: push
jobs:
  job1:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - uses: actions/setup-dotnet@v1
        with:
          dotnet-version: 5.0.x
```

### Simple example using recommended dependencies:

```yaml
steps:
- uses: retypeapp/action-build
```

Adding the **setup-dotnet** action will ensure .NET 5 is available, so the action will choose the smaller **dotnet tool** retype installation instead of the NPM one. The NPM version is larger in size because it carries on .NET dependencies cross-platform.

## Specify a custom base directory

In case the target hosting will not be in the website's root, the path to documentation must be explicitly specified. For convenience, the action can override the `base` setting in **retype.json** to the desired value if it can't be committed to the config file (or when using default config).

```yaml
- name: Sets a variable with the repository name, stripping out owner/organization
  id: clean-repo-name
  shell: bash
  run: echo "::set-output name=repository_name::${GITHUB_REPOSITORY#${{ github.repository_owner }}/}"

- uses: retypeapp/action-build
  with:
    base: "${{ steps.clean-repo-name.outputs.repository_name }}"
```

The example above is useful to set up GitHub Pages using the **_repo-owner_.github.io/_repo-name_** path for hosting documentation built by retype. For more information on GitHub pages, see [Working with GitHub Pages at GitHub Docs](https://docs.github.com/en/github/working-with-github-pages).

## Specify a custom project name

The `title` setting in **retype.json** can be overridden with the `project-name` action input.

```yaml
- uses: retypeapp/action-build
  with:
    project-name: "My Project"
```

While this may help get started with documentation when there's no **retype.json** file in the repository's root, it's best to define the project name in the config file (`title` setting).

## Specify Retype license key

The `license` setting in **retype.json** can be securely specified with the `license` action input. Please make sure to use it as a secret.

```yaml
- uses: retypeapp/action-build
  with:
    license: ${{ secrets.RETYPE_LICENSE_KEY }}
```

For more information on how to set up and use secrets in GitHub actions, see [Encrypted secrets at GitHub Docs](https://docs.github.com/en/actions/reference/encrypted-secrets).

## Using the output path in a custom action

It is possible to get the output path of the built Retype documentation website to use with custom steps/actions after **retype build** action is done. To do so, use the action's `retype-output-root` **output** value.

```yaml
- uses: retypeapp/action-build
  id: build1

- shell: bash
  env:
    RETYPE_BUILD_PATH: ${{ steps.build1.outputs.retype-output-root }}
  run: echo "Retype config is at '${RETYPE_BUILT_PATH}' and the actual output at '${RETYPE_BUILT_PATH}'."
```

Other retype actions internally rely on the `RETYPE_OUTPUT_ROOT` environment variable exported by this action, but to ensure your action will work with future versions, it is safer to reference the explicit output value.

**Notice:** If the custom action runs on another job, see the next example for means to persist the built documentation website.

it is needed to actually upload the built documentation with [actions/upload-artifact](https://github.com/actions/upload-artifact), as changes in the file system are not available across different GitHub actions' jobs. Then from the outside job, the artifact can be retrieved using the **download-artifact** action. See examples using the action below; more information on the **upload-artifact** and **download-artifact** actions available at, respectively, https://github.com/actions/upload-artifact and https://github.com/actions/download-artifact.

## Uploading retype built website as an artifact

To use the built documentation in different jobs in the same workflow, or let an external source download it, it is possible to use [actions/upload-artifact](https://github.com/actions/upload-artifact) to persist the files. The uploaded artifact can then be retrieved in another job or workflow using [actions/download-artifact](https://github.com/actions/download-artifact)

```yaml
- uses: retypeapp/action-build
  id: build1

- uses: actions/upload-artifact@v2
  with:
    path: ${{ steps.build1.outputs.retype-output-root }}
```

## Pushing back to GitHub Pages

Retype has a dedicated action that allows to easily push back built documentation to the GitHub repository's branch and/or subdirectory where GitHub Pages is set up at.

The snippet below illustrates how to add GitHub Pages publishing support to a Retype Build workflow:

```yaml
- uses: retypeapp/action-build

- uses: retypeapp/action-github-pages
```

For more information on the GitHub Pages Retype action see [retypeapp/action-github-pages](https://github.com/retypeapp/action-github-pages).
